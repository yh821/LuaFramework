---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by admin.
--- DateTime: 2023/4/4 22:03
---

require("behavior/behaviorManager")

---@class AiManager
---@field _bt_list behaviorTree[]
AiManager = AiManager or BaseClass()

function AiManager:__init()
	if AiManager.Instance then
		logError("[AiManager] attempt to create singleton twice!")
		return
	end
	AiManager.Instance = self

	self._bt_list = {}

	Runner.Instance:AddRunObj(self, 9)
end

function AiManager:__delete()
	Runner.Instance:RemoveRunObj(self)

	self._bt_list = nil

	AiManager.Instance = nil
end

function AiManager:Update(realtime, delta_time)
	behaviorManager:Update(delta_time)
end

function AiManager:StartThinking(is_on)
	behaviorManager:switchTick(is_on)
end

---@return behaviorTree 一个实体只能绑定一个行为树
function AiManager:BindBT(gameObject, file)
	local bt = behaviorManager:bindBehaviorTree(gameObject, file)
	if not bt then
		return
	end
	bt:setSharedVar(AiConfig.scene_obj, gameObject)
	self._bt_list[gameObject] = bt
	return bt
end

function AiManager:UnBindBT(gameObject)
	behaviorManager:unBindBehaviorTree(gameObject)
	self._bt_list[gameObject] = nil
end
